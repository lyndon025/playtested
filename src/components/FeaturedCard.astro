---
import { type CollectionEntry } from "astro:content";
import SiteOptions from "../site.config.mjs";
import ScoreBadge from "./ScoreBadge.astro";
import { Image } from 'astro:assets';

export interface Props {
  post: CollectionEntry<"article">;
}

const { post } = Astro.props;
const { title, description, thumb, score, author } = post.data;
const roundedScore = typeof score === 'number' ? Math.round(score) : null;
---
<article
 class="
    bg-gray-50 dark:bg-slate-800 rounded-lg shadow-sm
    p-6
    h-full           /* fill the wrapperâ€™s height */
    flex flex-col    /* allow distributing inside */"
>
  {
    SiteOptions.showThumbnailOnFeaturedPosts && thumb && (
      <a href={`/article/${post.slug}/`} class="w-full block group relative featured-card-thumb">
        <div class="w-full aspect-video mb-6 rounded-xl overflow-hidden shadow-md max-w-4xl mx-auto relative">
          <Image
            src={thumb}
            alt={title}
            width={640}
            height={360}
            loading="eager"
            class="w-full h-full object-cover transition-transform duration-300 group-hover:scale-105"
            placeholder="blur"
          />
          <ScoreBadge score={post.data.score} small />
        </div>
      </a>
    )
  }

  <h3 class="text-xl font-bold mb-2">
    <a href={`/article/${post.slug}/`}>{title}</a>
  </h3>

  <p class="text-gray-500 dark:text-gray-400 text-sm mb-4 flex-grow desc-clamp">
    {description}
  </p>

  <div class="mt-auto flex items-center justify-between w-full">
    {
      SiteOptions.showReadMoreLinkOnFeaturedPosts && (
        <a
          href={`/article/${post.slug}/`}
          class="text-black dark:text-white underline text-sm hover:text-blue-600 dark:hover:text-blue-400"
        >
          {SiteOptions.labels.readMore}
        </a>
      )
    }

    <div class="text-xs font-medium text-gray-500 dark:text-gray-400">
      <span class="mr-1">By</span>
      <a 
        href={`/author/${author.toLowerCase().replace(/\s+/g, '-')}/`}  
        class="hover:underline hover:text-blue-600 dark:hover:text-blue-400"
      >
        {author}
      </a>
    </div>
  </div>
</article>
